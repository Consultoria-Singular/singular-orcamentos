<main class="container layout-column">
  <app-toolbar
    title="Projetos"
    subtitle="Acompanhe os orcamentos e configure os detalhes de cada projeto"
    [breadcrumbs]="[{ label: 'Projetos' }]"
    [hasProjectedActions]="true"
    [showThemeToggle]="true">
    <div toolbar-actions>
      <ds-button variant="primary" (buttonClick)="onCreateProject()">
        Novo projeto
      </ds-button>
      <ds-button variant="ghost" (buttonClick)="reload()" [disabled]="loading">
        Recarregar
      </ds-button>
    </div>
  </app-toolbar>

  <section *ngIf="loading" class="loading-state">
    <span class="loading-spinner" aria-hidden="true"></span>
    <span>Carregando projetos...</span>
  </section>

  <section *ngIf="error && !loading" class="alert" role="alert">
    {{ error }}
    <div class="table-actions" style="margin-top: var(--space-2);">
      <ds-button variant="ghost" (buttonClick)="reload()">Tentar novamente</ds-button>
    </div>
  </section>

  <section *ngIf="!loading && !error && projects.length" class="table-wrapper" aria-live="polite">
    <table class="table">
      <thead>
        <tr>
          <th>Projeto</th>
          <th>Status</th>
          <th>Total</th>
          <th>Epicos</th>
          <th>Itens</th>
          <th class="col-actions">Detalhes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let project of projects; trackBy: trackByProject">
          <td>
            <strong>{{ project.name }}</strong>
          </td>
          <td class="col-status">
            <span class="status-pill" [ngClass]="getStatusClass(project.status)">
              {{ getStatusLabel(project.status) }}
            </span>
          </td>
          <td>{{ project.total | currencyFormat }}</td>
          <td>{{ project.epics.length }}</td>
          <td>{{ project.budgetItems.length }}</td>
          <td class="col-actions">
            <button
              type="button"
              class="detail-button"
              (click)="onViewDetails(project.id)"
              [attr.aria-label]="'Ver detalhes do projeto ' + project.name">
              <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path
                  d="M11 4a7 7 0 0 1 5.65 11.06l3.8 3.8a1 1 0 1 1-1.42 1.42l-3.8-3.8A7 7 0 1 1 11 4zm0 2a5 5 0 1 0 0 10 5 5 0 0 0 0-10z"
                  fill="currentColor" />
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </section>

  <section *ngIf="!loading && !error && !projects.length" class="sg-empty-state" aria-live="polite">
    <h3>Nenhum projeto cadastrado</h3>
    <p>Comece criando um novo projeto e configure seus dados de orcamento.</p>
    <ds-button variant="primary" size="sm" (buttonClick)="onCreateProject()">Criar projeto</ds-button>
  </section>
</main>
